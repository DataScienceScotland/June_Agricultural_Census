---
title: "Module validations"
date: "`r Sys.Date()`"
sgtemplates:
  datatables:
    features:
      info: true
      ordering: true
      paging: true
      searching: false
  header:
    phase_banner:
      tag: "WIP"
      text: "This is a work in progress."
    site_branding: "Scottish Government"
  metadata:
    label: "Report"
  navigation:
    toc:
      sticky: false
output:
  html_document:
    code_download: false
    df_print: paged
    fig_caption: true
    number_sections: false
    self_contained: false
    template: "_template.html"
    toc: true
    toc_depth: 2
    toc_float: true
---

```{r setup, include = FALSE }
library(tidyverse)
library(knitr)
#yr = this year 20xx
yr <- 2023
yr1 <- yr-2 
yr2 <-  yr-3
yr3 <-  yr-4
yr_list <- c(yr, yr1, yr2)

knitr::opts_chunk$set(echo = FALSE)


#Script containing datasets and error checks
source("Module validations.R",  local = knitr::knit_global())

```

# JAC Survey - Module checks

## Module error 1

The following table displays errors for holdings where the total percentage of the manure/slurry spread not equal to 100 percent

```{r, module-validations-merr1, results = 'markup'}

merr1 <- merr1 %>% filter(error == "Error")   

  ifelse(nrow(merr1) ==0, "No errors found", "Errors found")
kable(merr1, caption = "Total percentage of the manure/slurry spread not equal to 100 percent" )


```

## Module error 2

The following table displays possible errors for holdings where total percentage of manure/slurry storage not equal to 100 percent

```{r, module-validations-merr2, results = 'markup'}

merr2 <- merr2 %>% filter(error == "Error")   

  ifelse(nrow(merr2) ==0, "No errors found", "Errors found")
kable(merr2, caption = "Total percentage of the manure/slurry storage not equal to 100 percent" )



```

## Module error 3

The following table displays possible errors for holdings that have indicated nutrient management but have not given areas of grassland or cropland

```{r, module-validations-merr3, results = 'markup'}

merr3 <- merr3 %>% filter(error == "Error")   

  ifelse(nrow(merr3) ==0, "No errors found", "Errors found")
kable(merr3, caption = "Indicated nutrient management but have not given areas of grassland or cropland " )
```

## Module error 4

The following table displays possible errors for holdings where the sum of general crop rotation land and land not included in general crop rotation is greater than the total area item12

```{r, module-validations-merr4, results = 'markup'}

merr4 <- merr4 %>% filter(error == "Error")   

  ifelse(nrow(merr4) ==0, "No errors found", "Errors found")
kable(merr4, caption = "Sum of general crop rotation land and land not included in general crop rotation is greater than the total area item12" )

```

## Module error 5

The following table displays possible errors for holdings where the sum of area pH tested (grassland and cropland) is greater than total area item12

```{r, module-validations-merr5, results = 'markup'}

merr5 <- merr5 %>% filter(error == "Error")   

  ifelse(nrow(merr5) ==0, "No errors found", "Errors found")
kable(merr5, caption = "Sum of area pH tested (grassland and cropland) is greater than total area item12" )

```

## Module error 6

The following table displays possible errors for holdings where sum of area nutrient management plan (grassland and cropland) is greater than total area item12

```{r, module-validations-merr6, results = 'markup'}

merr6<- merr6%>% filter(error == "Error")   

  ifelse(nrow(merr6) ==0, "No errors found", "Errors found")
kable(merr6, caption = "Sum of area nutrient management plan (grassland and cropland) is greater than total area item12" )

```

## Module error 7

The following table displays possible errors for holdings where the sum of total farmed area fertilised with mineral and manure fertilisers greater than total area item12

```{r, module-validations-merr7, results = 'markup'}

merr7<- merr7%>% filter(error == "Error")   

  ifelse(nrow(merr7) ==0, "No errors found", "Errors found")
kable(merr7,  caption = "Sum of total farmed area fertilised with mineral and manure fertilisers greater than total area item12" )

```

# Module error summary table

The following table displays the count and type of context errors grouped by "submisType".

```{r, punch error tables-module error summary, results = 'markup'}

kable(module_validation_error_summary, caption = "count of module errors by submisType")

```
